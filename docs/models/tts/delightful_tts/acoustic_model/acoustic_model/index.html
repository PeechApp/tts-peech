
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../readme/">
      
      
        <link rel="next" href="../embedding/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.6">
    
    
      
        <title>Accoustic Model - TTS-Framework</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.35e1ed30.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="TTS-Framework" class="md-header__button md-logo" aria-label="TTS-Framework" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TTS-Framework
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Accoustic Model
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="TTS-Framework" class="md-nav__button md-logo" aria-label="TTS-Framework" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    TTS-Framework
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Dev docs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Dev docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/change_log/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Change Log
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/problems_and_fixes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Problems and Fixes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lightning docs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Lightning docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5_2" >
        
          
          <label class="md-nav__link" for="__nav_2_5_2" id="__nav_2_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Basic
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5_2">
            <span class="md-nav__icon md-icon"></span>
            Basic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/basic/argparse_and_cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Argparse and Hyperparams
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/basic/debug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/basic/early_stopping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Early Stopping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/basic/find_bottlenecks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Find Bottlenecks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/basic/saving_loading_checkpoints/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Saving Loading checkpoints
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/basic/visualize_experiments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualize Experiments
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5_3" >
        
          
          <label class="md-nav__link" for="__nav_2_5_3" id="__nav_2_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Intermediate
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5_3">
            <span class="md-nav__icon md-icon"></span>
            Intermediate
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/intermediate/hardware_agnostic_training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hardware-Agnostic training
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/intermediate/gpu_training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPU training
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/intermediate/lightning_data_module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lightning Data Module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/intermediate/configure_hyperparameters_from_the_cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure hyperparameters from the CLI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/intermediate/customize_checkpointing_behavior/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customize checkpointing behavior
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/intermediate/track_and_visualize_experiments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Track and Visualize Experiments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/intermediate/sota_scaling_techniques/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SOTA scaling techniques (N-Bit Precision)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/intermediate/effective_training_techniques/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Important! Effective Training Techniques (Acc grad,cliping)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/intermediate/deploy_models_into_production/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploy Models into Production
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5_4" >
        
          
          <label class="md-nav__link" for="__nav_2_5_4" id="__nav_2_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5_4">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/advanced/hyperparameters_from_the_cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure hyperparameters from the CLI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../dev/lightning/advanced/own_your_loop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customize training loop
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Models
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Config
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Config
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../config/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../config/langs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Langs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Enhancer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Enhancer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_1" >
        
          
          <label class="md-nav__link" for="__nav_3_2_1" id="__nav_3_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Gaussian Diffusion
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_1">
            <span class="md-nav__icon md-icon"></span>
            Gaussian Diffusion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../enhancer/gaussian_diffusion/gaussian_diffusion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gaussian Diffusion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../enhancer/gaussian_diffusion/denoiser/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Denoiser
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../enhancer/gaussian_diffusion/layers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Layers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../enhancer/gaussian_diffusion/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    TTS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            TTS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3_1" id="__nav_3_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Delightful TTS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3_1">
            <span class="md-nav__icon md-icon"></span>
            Delightful TTS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../delightful_tts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DelightfulTTS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_1_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3_1_3" id="__nav_3_3_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Convolution Blocks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_1_3">
            <span class="md-nav__icon md-icon"></span>
            Convolution Blocks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../conv_blocks/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../conv_blocks/activation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Activation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../conv_blocks/conv1d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conv1d
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../conv_blocks/bsconv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BSConv
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../conv_blocks/conv1d_glu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conv1dGLU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../conv_blocks/conv_transposed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ConvTransposed
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../conv_blocks/coord_conv1d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CoordConv1d
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../conv_blocks/add_coords/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AddCoords
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_1_4" >
        
          
          <label class="md-nav__link" for="__nav_3_3_1_4" id="__nav_3_3_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Attention
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_1_4">
            <span class="md-nav__icon md-icon"></span>
            Attention
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../attention/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../attention/conformer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conformer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../attention/feed_forward/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feed Forward
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../attention/style_embed_attention/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Style Embed Attention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../attention/multi_head_attention/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi-Head Attention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../attention/relative_multi_head_attention/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Relative Multi-Head Attention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../attention/conformer_multi_headed_self_attention/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conformer Multi-Headed Self Attention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../attention/conformer_conv_module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conformer Convolution Module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../attention/conformer_block/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conformer Block
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_1_5" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3_1_5" id="__nav_3_3_1_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Acoustic Model
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_1_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3_1_5">
            <span class="md-nav__icon md-icon"></span>
            Acoustic Model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aligner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aligner
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Accoustic Model
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Accoustic Model
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model" class="md-nav__link">
    acoustic_model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel" class="md-nav__link">
    AcousticModel
  </a>
  
    <nav class="md-nav" aria-label="AcousticModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.average_utterance_prosody" class="md-nav__link">
    average_utterance_prosody()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.forward_train" class="md-nav__link">
    forward_train()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.freeze_params" class="md-nav__link">
    freeze_params()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.get_embeddings" class="md-nav__link">
    get_embeddings()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.prepare_for_export" class="md-nav__link">
    prepare_for_export()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.unfreeze_params" class="md-nav__link">
    unfreeze_params()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../embedding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Embedding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../helpers.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Helpers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../variance_predictor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Variance Predictor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../pitch_adaptor_conv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pitch Adaptor Conv
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../energy_adaptor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Energy Adaptor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../length_adaptor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Length Adaptor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../phoneme_prosody_predictor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phoneme Prosody Predictor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_1_5_11" >
        
          
          <label class="md-nav__link" for="__nav_3_3_1_5_11" id="__nav_3_3_1_5_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Aligner
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_3_1_5_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_1_5_11">
            <span class="md-nav__icon md-icon"></span>
            Aligner
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../mas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monotonic Alignments Shrink
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_1_6" >
        
          
          <label class="md-nav__link" for="__nav_3_3_1_6" id="__nav_3_3_1_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference Encoder
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_1_6">
            <span class="md-nav__icon md-icon"></span>
            Reference Encoder
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../reference_encoder/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../reference_encoder/STL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Style Token Layer (STL)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../reference_encoder/reference_encoder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference Encoder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../reference_encoder/utterance_level_prosody_encoder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utterance Level Prosody Encoder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../reference_encoder/phoneme_level_prosody_encoder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phoneme Level Prosody Encoder
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2" id="__nav_3_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    StyledTTS 2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2">
            <span class="md-nav__icon md-icon"></span>
            StyledTTS 2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../styledtts2/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_2" id="__nav_3_3_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Diffusion
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            Diffusion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../styledtts2/diffusion/diffusion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diffusion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../styledtts2/diffusion/distributions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distributions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../styledtts2/diffusion/embeddings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Embeddings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../styledtts2/diffusion/attention/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Attention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../styledtts2/diffusion/ada_layer_norm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AdaLayerNorm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../styledtts2/diffusion/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Vocoder
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Vocoder
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_1" >
        
          
          <label class="md-nav__link" for="__nav_3_4_1" id="__nav_3_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Univnet
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_1">
            <span class="md-nav__icon md-icon"></span>
            Univnet
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../vocoder/univnet/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../vocoder/univnet/univnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Univnet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../vocoder/univnet/generator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../vocoder/univnet/traced_generator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Traced Generator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../vocoder/univnet/kernel_predictor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kernel Predictor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../vocoder/univnet/lvc_block/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LVC Block
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../vocoder/univnet/discriminator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Discriminator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../vocoder/univnet/discriminator_p/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DiscriminatorP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../vocoder/univnet/discriminator_r/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DiscriminatorR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../vocoder/univnet/multi_period_discriminator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi Period Discriminator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../vocoder/univnet/multi_resolution_discriminator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi Resolution Discriminator
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Helpers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Helpers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../helpers/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../helpers/initializer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Initializer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../helpers/acoustic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acoustic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../helpers/tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tools
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Training
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Training
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Loss
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Loss
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/loss/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2_2" id="__nav_4_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Acoustic Losses
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_2">
            <span class="md-nav__icon md-icon"></span>
            Acoustic Losses
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/loss/bin_loss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binary Cross Entropy Loss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/loss/forward_sum_loss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Forward Sum Loss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/loss/fast_speech_2_loss_gen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FastSpeech 2 Loss
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_3" id="__nav_4_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Voicoder Losses
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_3">
            <span class="md-nav__icon md-icon"></span>
            Voicoder Losses
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/loss/stft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    STFT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/loss/stft_loss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    STFT Loss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/loss/log_stft_magnitude_loss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Log STFT Magnitude Loss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/loss/spectral_convergence_loss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spectral Convergence Loss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/loss/multi_resolution_stft_loss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi Resolution STFT Loss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/loss/univnet_loss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Univnet loss
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Datasets
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/dataset/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/dataset/libritts_dataset_acoustic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Libri TTS dataset acoustic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/dataset/libritts_dataset_vocoder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Libri TTS dataset vocoder
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Preprocess
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Preprocess
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/preprocess/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/preprocess/audio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Audio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/preprocess/audio_processor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Audio Processor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/preprocess/compute_yin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    compute_yin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/preprocess/normalize_text/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Normalize Text
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/preprocess/preprocess_libritts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preprocess LibriTTS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/preprocess/tacotron_stft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TacotronSTFT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/preprocess/wav2vec_aligner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wav2Vec Aligner
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../training/tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tools
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Experiments
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Experiments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../experiments/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../experiments/mas_torch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MAS torch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../experiments/conv_leaky_relu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conv Leaky ReLU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../experiments/tokenization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tokenization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Optimizer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Optimizer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../experiments/optimizer/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../experiments/optimizer/scheduled_optim_pretraining/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scheduled Optim Pretraining
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../experiments/optimizer/scheduled_optim_finetuning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scheduled Optim Finetuning
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About mkdocs-material
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model" class="md-nav__link">
    acoustic_model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel" class="md-nav__link">
    AcousticModel
  </a>
  
    <nav class="md-nav" aria-label="AcousticModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.average_utterance_prosody" class="md-nav__link">
    average_utterance_prosody()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.forward_train" class="md-nav__link">
    forward_train()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.freeze_params" class="md-nav__link">
    freeze_params()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.get_embeddings" class="md-nav__link">
    get_embeddings()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.prepare_for_export" class="md-nav__link">
    prepare_for_export()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.unfreeze_params" class="md-nav__link">
    unfreeze_params()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Accoustic Model</h1>

<div class="doc doc-object doc-module">



<a id="models.tts.delightful_tts.acoustic_model.acoustic_model"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel" class="doc doc-heading">
          <code>AcousticModel</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="torch.nn.Module">Module</span></code></p>

  
      <p>The DelightfulTTS AcousticModel class represents a PyTorch module for an acoustic model in text-to-speech (TTS).
The acoustic model is responsible for predicting speech signals from phoneme sequences.</p>
<p>The model comprises multiple sub-modules including encoder, decoder and various prosody encoders and predictors.
Additionally, a pitch and length adaptor are instantiated.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>preprocess_config</code></td>
          <td>
                <code><span title="models.config.PreprocessingConfig">PreprocessingConfig</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Object containing the configuration used for preprocessing the data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model_config</code></td>
          <td>
                <code><span title="models.config.AcousticModelConfigType">AcousticModelConfigType</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Configuration object containing various model parameters</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n_speakers</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Total number of speakers in the dataset</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>leaky_relu_slope</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Slope for the leaky relu. Defaults to LEAKY_RELU_SLOPE.</p>
            </div>
          </td>
          <td>
                <code><span title="models.tts.delightful_tts.constants.LEAKY_RELU_SLOPE">LEAKY_RELU_SLOPE</span></code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="note" open>
  <summary>Note</summary>
  <p>For more specific details on the implementation of sub-modules please refer to their individual respective modules.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>models/tts/delightful_tts/acoustic_model/acoustic_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AcousticModel</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;The DelightfulTTS AcousticModel class represents a PyTorch module for an acoustic model in text-to-speech (TTS).</span>
<span class="sd">    The acoustic model is responsible for predicting speech signals from phoneme sequences.</span>

<span class="sd">    The model comprises multiple sub-modules including encoder, decoder and various prosody encoders and predictors.</span>
<span class="sd">    Additionally, a pitch and length adaptor are instantiated.</span>

<span class="sd">    Args:</span>
<span class="sd">        preprocess_config (PreprocessingConfig): Object containing the configuration used for preprocessing the data</span>
<span class="sd">        model_config (AcousticModelConfigType): Configuration object containing various model parameters</span>
<span class="sd">        n_speakers (int): Total number of speakers in the dataset</span>
<span class="sd">        leaky_relu_slope (float, optional): Slope for the leaky relu. Defaults to LEAKY_RELU_SLOPE.</span>

<span class="sd">    Note:</span>
<span class="sd">        For more specific details on the implementation of sub-modules please refer to their individual respective modules.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">preprocess_config</span><span class="p">:</span> <span class="n">PreprocessingConfig</span><span class="p">,</span>
        <span class="n">model_config</span><span class="p">:</span> <span class="n">AcousticModelConfigType</span><span class="p">,</span>
        <span class="n">n_speakers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">leaky_relu_slope</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">LEAKY_RELU_SLOPE</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emb_dim</span> <span class="o">=</span> <span class="n">model_config</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">n_hidden</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">Conformer</span><span class="p">(</span>
            <span class="n">dim</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">,</span>
            <span class="n">n_layers</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">n_layers</span><span class="p">,</span>
            <span class="n">n_heads</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">n_heads</span><span class="p">,</span>
            <span class="n">embedding_dim</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">speaker_embed_dim</span> <span class="o">+</span> <span class="n">model_config</span><span class="o">.</span><span class="n">lang_embed_dim</span><span class="p">,</span>
            <span class="n">p_dropout</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">p_dropout</span><span class="p">,</span>
            <span class="n">kernel_size_conv_mod</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">kernel_size_conv_mod</span><span class="p">,</span>
            <span class="n">with_ff</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">with_ff</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pitch_adaptor_conv</span> <span class="o">=</span> <span class="n">PitchAdaptorConv</span><span class="p">(</span>
            <span class="n">channels_in</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">,</span>
            <span class="n">channels_hidden</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">variance_adaptor</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">,</span>
            <span class="n">channels_out</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">kernel_size</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">variance_adaptor</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">,</span>
            <span class="n">emb_kernel_size</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">variance_adaptor</span><span class="o">.</span><span class="n">emb_kernel_size</span><span class="p">,</span>
            <span class="n">dropout</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">variance_adaptor</span><span class="o">.</span><span class="n">p_dropout</span><span class="p">,</span>
            <span class="n">leaky_relu_slope</span><span class="o">=</span><span class="n">leaky_relu_slope</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">energy_adaptor</span> <span class="o">=</span> <span class="n">EnergyAdaptor</span><span class="p">(</span>
            <span class="n">channels_in</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">,</span>
            <span class="n">channels_hidden</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">variance_adaptor</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">,</span>
            <span class="n">channels_out</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">kernel_size</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">variance_adaptor</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">,</span>
            <span class="n">emb_kernel_size</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">variance_adaptor</span><span class="o">.</span><span class="n">emb_kernel_size</span><span class="p">,</span>
            <span class="n">dropout</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">variance_adaptor</span><span class="o">.</span><span class="n">p_dropout</span><span class="p">,</span>
            <span class="n">leaky_relu_slope</span><span class="o">=</span><span class="n">leaky_relu_slope</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">length_regulator</span> <span class="o">=</span> <span class="n">LengthAdaptor</span><span class="p">(</span><span class="n">model_config</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">utterance_prosody_encoder</span> <span class="o">=</span> <span class="n">UtteranceLevelProsodyEncoder</span><span class="p">(</span>
            <span class="n">preprocess_config</span><span class="p">,</span>
            <span class="n">model_config</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">utterance_prosody_predictor</span> <span class="o">=</span> <span class="n">PhonemeProsodyPredictor</span><span class="p">(</span>
            <span class="n">model_config</span><span class="o">=</span><span class="n">model_config</span><span class="p">,</span>
            <span class="n">phoneme_level</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phoneme_prosody_encoder</span> <span class="o">=</span> <span class="n">PhonemeLevelProsodyEncoder</span><span class="p">(</span>
            <span class="n">preprocess_config</span><span class="p">,</span>
            <span class="n">model_config</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phoneme_prosody_predictor</span> <span class="o">=</span> <span class="n">PhonemeProsodyPredictor</span><span class="p">(</span>
            <span class="n">model_config</span><span class="o">=</span><span class="n">model_config</span><span class="p">,</span>
            <span class="n">phoneme_level</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">u_bottle_out</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span>
            <span class="n">model_config</span><span class="o">.</span><span class="n">reference_encoder</span><span class="o">.</span><span class="n">bottleneck_size_u</span><span class="p">,</span>
            <span class="n">model_config</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">u_norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span>
            <span class="n">model_config</span><span class="o">.</span><span class="n">reference_encoder</span><span class="o">.</span><span class="n">bottleneck_size_u</span><span class="p">,</span>
            <span class="n">elementwise_affine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p_bottle_out</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span>
            <span class="n">model_config</span><span class="o">.</span><span class="n">reference_encoder</span><span class="o">.</span><span class="n">bottleneck_size_p</span><span class="p">,</span>
            <span class="n">model_config</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p_norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span>
            <span class="n">model_config</span><span class="o">.</span><span class="n">reference_encoder</span><span class="o">.</span><span class="n">bottleneck_size_p</span><span class="p">,</span>
            <span class="n">elementwise_affine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">aligner</span> <span class="o">=</span> <span class="n">Aligner</span><span class="p">(</span>
            <span class="n">d_enc_in</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">,</span>
            <span class="n">d_dec_in</span><span class="o">=</span><span class="n">preprocess_config</span><span class="o">.</span><span class="n">stft</span><span class="o">.</span><span class="n">n_mel_channels</span><span class="p">,</span>
            <span class="n">d_hidden</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">Conformer</span><span class="p">(</span>
            <span class="n">dim</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">,</span>
            <span class="n">n_layers</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">n_layers</span><span class="p">,</span>
            <span class="n">n_heads</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">n_heads</span><span class="p">,</span>
            <span class="n">embedding_dim</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">speaker_embed_dim</span> <span class="o">+</span> <span class="n">model_config</span><span class="o">.</span><span class="n">lang_embed_dim</span><span class="p">,</span>
            <span class="n">p_dropout</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">p_dropout</span><span class="p">,</span>
            <span class="n">kernel_size_conv_mod</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">kernel_size_conv_mod</span><span class="p">,</span>
            <span class="n">with_ff</span><span class="o">=</span><span class="n">model_config</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">with_ff</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">src_word_emb</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">initialize_embeddings</span><span class="p">(</span>
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">),</span> <span class="n">model_config</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">to_mel</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span>
            <span class="n">model_config</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">,</span>
            <span class="n">preprocess_config</span><span class="o">.</span><span class="n">stft</span><span class="o">.</span><span class="n">n_mel_channels</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># NOTE: here you can manage the speaker embeddings, can be used for the voice export ?</span>
        <span class="c1"># NOTE: flexibility of the model binded by the n_speaker parameter, maybe I can find another way?</span>
        <span class="c1"># NOTE: in LIBRITTS there are 2477 speakers, we can add more, just extend the speaker_embed matrix</span>
        <span class="c1"># Need to think about it more</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speaker_embed</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">initialize_embeddings</span><span class="p">(</span>
                <span class="p">(</span><span class="n">n_speakers</span><span class="p">,</span> <span class="n">model_config</span><span class="o">.</span><span class="n">speaker_embed_dim</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lang_embed</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">initialize_embeddings</span><span class="p">(</span>
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SUPPORTED_LANGUAGES</span><span class="p">),</span> <span class="n">model_config</span><span class="o">.</span><span class="n">lang_embed_dim</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_embeddings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">token_idx</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">speaker_idx</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">src_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">lang_idx</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Given the tokens, speakers, source mask, and language indices, compute</span>
<span class="sd">        the embeddings for tokens, speakers and languages and return the</span>
<span class="sd">        token_embeddings and combined speaker and language embeddings</span>

<span class="sd">        Args:</span>
<span class="sd">            token_idx (torch.Tensor): Tensor of token indices.</span>
<span class="sd">            speaker_idx (torch.Tensor): Tensor of speaker identities.</span>
<span class="sd">            src_mask (torch.Tensor): Mask tensor for source sequences.</span>
<span class="sd">            lang_idx (torch.Tensor): Tensor of language indices.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[torch.Tensor, torch.Tensor]: Token embeddings tensor,</span>
<span class="sd">            and combined speaker and language embeddings tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">token_embeddings</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">token_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_word_emb</span><span class="p">)</span>
        <span class="c1"># NOTE: here you can manage the speaker embeddings, can be used for the voice export ?</span>
        <span class="n">speaker_embeds</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">speaker_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">speaker_embed</span><span class="p">)</span>
        <span class="n">lang_embeds</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">lang_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang_embed</span><span class="p">)</span>

        <span class="c1"># Merge the speaker and language embeddings</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">speaker_embeds</span><span class="p">,</span> <span class="n">lang_embeds</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Apply the mask to the embeddings and token embeddings</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">masked_fill</span><span class="p">(</span><span class="n">src_mask</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">token_embeddings</span> <span class="o">=</span> <span class="n">token_embeddings</span><span class="o">.</span><span class="n">masked_fill</span><span class="p">(</span><span class="n">src_mask</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">token_embeddings</span><span class="p">,</span> <span class="n">embeddings</span>

    <span class="k">def</span> <span class="nf">prepare_for_export</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Prepare the model for export.</span>

<span class="sd">        This method is called when the model is about to be exported, such as for deployment</span>
<span class="sd">        or serializing for later use. The method removes unnecessary components that are</span>
<span class="sd">        not needed during inference. Specifically, it removes the phoneme and utterance</span>
<span class="sd">        prosody encoders for this acoustic model. These components are typically used during</span>
<span class="sd">        training and are not needed when the model is used for making predictions.</span>

<span class="sd">        Returns</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">phoneme_prosody_encoder</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">utterance_prosody_encoder</span>

    <span class="c1"># NOTE: freeze/unfreeze params changed, because of the conflict with the lightning module</span>
    <span class="k">def</span> <span class="nf">freeze_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Freeze the trainable parameters in the model.</span>

<span class="sd">        By freezing, the parameters are no longer updated by gradient descent.</span>
<span class="sd">        This is typically done when you want to keep parts of your model fixed while training other parts.</span>
<span class="sd">        For this model, it freezes all parameters and then selectively unfreezes the</span>
<span class="sd">        speaker embeddings and the pitch adaptor&#39;s pitch embeddings to allow these components to update during training.</span>

<span class="sd">        Returns</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
            <span class="n">par</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speaker_embed</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># NOTE: freeze/unfreeze params changed, because of the conflict with the lightning module</span>
    <span class="k">def</span> <span class="nf">unfreeze_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freeze_text_embed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">freeze_lang_embed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Unfreeze the trainable parameters in the model, allowing them to be updated during training.</span>

<span class="sd">        This method is typically used to &#39;unfreeze&#39; previously &#39;frozen&#39; parameters, making them trainable again.</span>
<span class="sd">        For this model, it unfreezes all parameters and then selectively freezes the</span>
<span class="sd">        text embeddings and language embeddings, if required.</span>

<span class="sd">        Args:</span>
<span class="sd">            freeze_text_embed (bool): Flag to indicate if text embeddings should remain frozen.</span>
<span class="sd">            freeze_lang_embed (bool): Flag to indicate if language embeddings should remain frozen.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Iterate through all model parameters and make them trainable</span>
        <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
            <span class="n">par</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># If freeze_text_embed flag is True, keep the source word embeddings frozen</span>
        <span class="k">if</span> <span class="n">freeze_text_embed</span><span class="p">:</span>
            <span class="c1"># @fixed self.src_word_emb.parameters has no parameters() method!</span>
            <span class="c1"># for par in self.src_word_emb.parameters():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">src_word_emb</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># If freeze_lang_embed flag is True, keep the language embeddings frozen</span>
        <span class="k">if</span> <span class="n">freeze_lang_embed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lang_embed</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">average_utterance_prosody</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">u_prosody_pred</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">src_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute the average utterance prosody over the length of non-masked elements.</span>

<span class="sd">        This method averages the output of the utterance prosody predictor over</span>
<span class="sd">        the sequence lengths (non-masked elements). This function will return</span>
<span class="sd">        a tensor with the same first dimension but singleton trailing dimensions.</span>

<span class="sd">        Args:</span>
<span class="sd">            u_prosody_pred (torch.Tensor): Tensor containing the predicted utterance prosody of dimension (batch_size, T, n_features).</span>
<span class="sd">            src_mask (torch.Tensor): Tensor of dimension (batch_size, T) acting as a mask where masked entries are set to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: Tensor of dimension (batch_size, 1, n_features) containing average utterance prosody over non-masked sequence length.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Compute the real sequence lengths by negating the mask and summing along the sequence dimension</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="p">((</span><span class="o">~</span><span class="n">src_mask</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Compute the sum of u_prosody_pred across the sequence length dimension,</span>
        <span class="c1">#  then divide by the sequence lengths tensor to calculate the average.</span>
        <span class="c1">#  This performs a broadcasting operation to account for the third dimension (n_features).</span>
        <span class="c1"># Return the averaged prosody prediction</span>
        <span class="k">return</span> <span class="n">u_prosody_pred</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">/</span> <span class="n">lengths</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward_train</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">speakers</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">src_lens</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">mels</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">mel_lens</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">pitches</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">langs</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">attn_priors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">energies</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Forward pass during training phase.</span>

<span class="sd">        For a given phoneme sequence, speaker identities, sequence lengths, mels,</span>
<span class="sd">        mel lengths, pitches, language, and attention priors, the forward pass</span>
<span class="sd">        processes these inputs through the defined architecture.</span>

<span class="sd">        Args:</span>
<span class="sd">            x (torch.Tensor): Tensor of phoneme sequence.</span>
<span class="sd">            speakers (torch.Tensor): Tensor of speaker identities.</span>
<span class="sd">            src_lens (torch.Tensor): Long tensor representing the lengths of source sequences.</span>
<span class="sd">            mels (torch.Tensor): Tensor of mel spectrograms.</span>
<span class="sd">            mel_lens (torch.Tensor): Long tensor representing the lengths of mel sequences.</span>
<span class="sd">            pitches (torch.Tensor): Tensor of pitch values.</span>
<span class="sd">            langs (torch.Tensor): Tensor of language identities.</span>
<span class="sd">            attn_priors (torch.Tensor): Prior attention values.</span>
<span class="sd">            energies (torch.Tensor): Tensor of energy values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, torch.Tensor]: Returns the prediction outputs as a dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Generate masks for padding positions in the source sequences and mel sequences</span>
        <span class="n">src_mask</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_mask_from_lengths</span><span class="p">(</span><span class="n">src_lens</span><span class="p">)</span>
        <span class="n">mel_mask</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_mask_from_lengths</span><span class="p">(</span><span class="n">mel_lens</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_embeddings</span><span class="p">(</span>
            <span class="n">token_idx</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">speaker_idx</span><span class="o">=</span><span class="n">speakers</span><span class="p">,</span>
            <span class="n">src_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
            <span class="n">lang_idx</span><span class="o">=</span><span class="n">langs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">encoding</span> <span class="o">=</span> <span class="n">positional_encoding</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emb_dim</span><span class="p">,</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">mel_lens</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">())),</span>
        <span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">src_mask</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">src_mask</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">src_mask</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

        <span class="n">u_prosody_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_norm</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">utterance_prosody_encoder</span><span class="p">(</span><span class="n">mels</span><span class="o">=</span><span class="n">mels</span><span class="p">,</span> <span class="n">mel_lens</span><span class="o">=</span><span class="n">mel_lens</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">u_prosody_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_norm</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_utterance_prosody</span><span class="p">(</span>
                <span class="n">u_prosody_pred</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">utterance_prosody_predictor</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">),</span>
                <span class="n">src_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="n">p_prosody_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_norm</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phoneme_prosody_encoder</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                <span class="n">src_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
                <span class="n">mels</span><span class="o">=</span><span class="n">mels</span><span class="p">,</span>
                <span class="n">mel_lens</span><span class="o">=</span><span class="n">mel_lens</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">p_prosody_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_norm</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phoneme_prosody_predictor</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_bottle_out</span><span class="p">(</span><span class="n">u_prosody_pred</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_bottle_out</span><span class="p">(</span><span class="n">p_prosody_pred</span><span class="p">)</span>

        <span class="c1"># Save the residual for later use</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">x</span>

        <span class="n">attn_logprob</span><span class="p">,</span> <span class="n">attn_soft</span><span class="p">,</span> <span class="n">attn_hard</span><span class="p">,</span> <span class="n">attn_hard_dur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aligner</span><span class="p">(</span>
            <span class="n">enc_in</span><span class="o">=</span><span class="n">x_res</span><span class="o">.</span><span class="n">permute</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
            <span class="n">dec_in</span><span class="o">=</span><span class="n">mels</span><span class="p">,</span>
            <span class="n">enc_len</span><span class="o">=</span><span class="n">src_lens</span><span class="p">,</span>
            <span class="n">dec_len</span><span class="o">=</span><span class="n">mel_lens</span><span class="p">,</span>
            <span class="n">enc_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
            <span class="n">attn_prior</span><span class="o">=</span><span class="n">attn_priors</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">attn_hard_dur</span> <span class="o">=</span> <span class="n">attn_hard_dur</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">src_mask</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">pitch_prediction</span><span class="p">,</span> <span class="n">avg_pitch_target</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pitch_adaptor_conv</span><span class="o">.</span><span class="n">add_pitch_embedding_train</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                <span class="n">target</span><span class="o">=</span><span class="n">pitches</span><span class="p">,</span>
                <span class="n">dr</span><span class="o">=</span><span class="n">attn_hard_dur</span><span class="p">,</span>
                <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">energies</span> <span class="o">=</span> <span class="n">energies</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">src_mask</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">energy_pred</span><span class="p">,</span> <span class="n">avg_energy_target</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">energy_adaptor</span><span class="o">.</span><span class="n">add_energy_embedding_train</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                <span class="n">target</span><span class="o">=</span><span class="n">energies</span><span class="p">,</span>
                <span class="n">dr</span><span class="o">=</span><span class="n">attn_hard_dur</span><span class="p">,</span>
                <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">log_duration_prediction</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_regulator</span><span class="o">.</span><span class="n">upsample_train</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">x_res</span><span class="o">=</span><span class="n">x_res</span><span class="p">,</span>
            <span class="n">duration_target</span><span class="o">=</span><span class="n">attn_hard_dur</span><span class="p">,</span>
            <span class="n">src_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
            <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Decode the encoder output to pred mel spectrogram</span>
        <span class="n">decoder_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="n">mel_mask</span><span class="p">,</span>
            <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">y_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_mel</span><span class="p">(</span><span class="n">decoder_output</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">permute</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;y_pred&quot;</span><span class="p">:</span> <span class="n">y_pred</span><span class="p">,</span>
            <span class="s2">&quot;pitch_prediction&quot;</span><span class="p">:</span> <span class="n">pitch_prediction</span><span class="p">,</span>
            <span class="s2">&quot;pitch_target&quot;</span><span class="p">:</span> <span class="n">avg_pitch_target</span><span class="p">,</span>
            <span class="s2">&quot;energy_pred&quot;</span><span class="p">:</span> <span class="n">energy_pred</span><span class="p">,</span>
            <span class="s2">&quot;energy_target&quot;</span><span class="p">:</span> <span class="n">avg_energy_target</span><span class="p">,</span>
            <span class="s2">&quot;log_duration_prediction&quot;</span><span class="p">:</span> <span class="n">log_duration_prediction</span><span class="p">,</span>
            <span class="s2">&quot;u_prosody_pred&quot;</span><span class="p">:</span> <span class="n">u_prosody_pred</span><span class="p">,</span>
            <span class="s2">&quot;u_prosody_ref&quot;</span><span class="p">:</span> <span class="n">u_prosody_ref</span><span class="p">,</span>
            <span class="s2">&quot;p_prosody_pred&quot;</span><span class="p">:</span> <span class="n">p_prosody_pred</span><span class="p">,</span>
            <span class="s2">&quot;p_prosody_ref&quot;</span><span class="p">:</span> <span class="n">p_prosody_ref</span><span class="p">,</span>
            <span class="s2">&quot;attn_logprob&quot;</span><span class="p">:</span> <span class="n">attn_logprob</span><span class="p">,</span>
            <span class="s2">&quot;attn_soft&quot;</span><span class="p">:</span> <span class="n">attn_soft</span><span class="p">,</span>
            <span class="s2">&quot;attn_hard&quot;</span><span class="p">:</span> <span class="n">attn_hard</span><span class="p">,</span>
            <span class="s2">&quot;attn_hard_dur&quot;</span><span class="p">:</span> <span class="n">attn_hard_dur</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">speakers</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">langs</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">d_control</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Forward pass during model inference.</span>

<span class="sd">        The forward pass receives phoneme sequence, speaker identities, languages, pitch control and</span>
<span class="sd">        duration control, conducts a series of operations on these inputs and returns the predicted mel</span>
<span class="sd">        spectrogram.</span>

<span class="sd">        Args:</span>
<span class="sd">            x (torch.Tensor): Tensor of phoneme sequences.</span>
<span class="sd">            speakers (torch.Tensor): Tensor of speaker identities.</span>
<span class="sd">            langs (torch.Tensor): Tensor of language identities.</span>
<span class="sd">            d_control (float): Duration control parameter. Defaults to 1.0.</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: Predicted mel spectrogram.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Generate masks for padding positions in the source sequences</span>
        <span class="n">src_mask</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_mask_from_lengths</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="c1"># Obtain the embeddings for the input</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_embeddings</span><span class="p">(</span>
            <span class="n">token_idx</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">speaker_idx</span><span class="o">=</span><span class="n">speakers</span><span class="p">,</span>
            <span class="n">src_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
            <span class="n">lang_idx</span><span class="o">=</span><span class="n">langs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Generate positional encodings</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="n">positional_encoding</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emb_dim</span><span class="p">,</span>
            <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="c1"># Process the embeddings through the encoder</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

        <span class="c1"># Predict prosody at utterance level and phoneme level</span>
        <span class="n">u_prosody_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_norm</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_utterance_prosody</span><span class="p">(</span>
                <span class="n">u_prosody_pred</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">utterance_prosody_predictor</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">),</span>
                <span class="n">src_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">p_prosody_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_norm</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phoneme_prosody_predictor</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_bottle_out</span><span class="p">(</span><span class="n">u_prosody_pred</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_bottle_out</span><span class="p">(</span><span class="n">p_prosody_pred</span><span class="p">)</span>

        <span class="n">x_res</span> <span class="o">=</span> <span class="n">x</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_adaptor_conv</span><span class="o">.</span><span class="n">add_pitch_embedding</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_adaptor</span><span class="o">.</span><span class="n">add_energy_embedding</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_regulator</span><span class="o">.</span><span class="n">upsample</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">x_res</span><span class="o">=</span><span class="n">x_res</span><span class="p">,</span>
            <span class="n">src_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
            <span class="n">control</span><span class="o">=</span><span class="n">d_control</span><span class="p">,</span>
            <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">mel_mask</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_mask_from_lengths</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">encoding</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">encoding</span> <span class="o">=</span> <span class="n">positional_encoding</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emb_dim</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="n">decoder_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="n">mel_mask</span><span class="p">,</span>
            <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_mel</span><span class="p">(</span><span class="n">decoder_output</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">permute</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.average_utterance_prosody" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">average_utterance_prosody</span><span class="p">(</span><span class="n">u_prosody_pred</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Compute the average utterance prosody over the length of non-masked elements.</p>
<p>This method averages the output of the utterance prosody predictor over
the sequence lengths (non-masked elements). This function will return
a tensor with the same first dimension but singleton trailing dimensions.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>u_prosody_pred</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor containing the predicted utterance prosody of dimension (batch_size, T, n_features).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>src_mask</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor of dimension (batch_size, T) acting as a mask where masked entries are set to False.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>torch.Tensor: Tensor of dimension (batch_size, 1, n_features) containing average utterance prosody over non-masked sequence length.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>models/tts/delightful_tts/acoustic_model/acoustic_model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">average_utterance_prosody</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">u_prosody_pred</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">src_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute the average utterance prosody over the length of non-masked elements.</span>

<span class="sd">    This method averages the output of the utterance prosody predictor over</span>
<span class="sd">    the sequence lengths (non-masked elements). This function will return</span>
<span class="sd">    a tensor with the same first dimension but singleton trailing dimensions.</span>

<span class="sd">    Args:</span>
<span class="sd">        u_prosody_pred (torch.Tensor): Tensor containing the predicted utterance prosody of dimension (batch_size, T, n_features).</span>
<span class="sd">        src_mask (torch.Tensor): Tensor of dimension (batch_size, T) acting as a mask where masked entries are set to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        torch.Tensor: Tensor of dimension (batch_size, 1, n_features) containing average utterance prosody over non-masked sequence length.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compute the real sequence lengths by negating the mask and summing along the sequence dimension</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="p">((</span><span class="o">~</span><span class="n">src_mask</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Compute the sum of u_prosody_pred across the sequence length dimension,</span>
    <span class="c1">#  then divide by the sequence lengths tensor to calculate the average.</span>
    <span class="c1">#  This performs a broadcasting operation to account for the third dimension (n_features).</span>
    <span class="c1"># Return the averaged prosody prediction</span>
    <span class="k">return</span> <span class="n">u_prosody_pred</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">/</span> <span class="n">lengths</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.forward" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">speakers</span><span class="p">,</span> <span class="n">langs</span><span class="p">,</span> <span class="n">d_control</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Forward pass during model inference.</p>
<p>The forward pass receives phoneme sequence, speaker identities, languages, pitch control and
duration control, conducts a series of operations on these inputs and returns the predicted mel
spectrogram.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor of phoneme sequences.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>speakers</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor of speaker identities.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>langs</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor of language identities.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>d_control</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Duration control parameter. Defaults to 1.0.</p>
            </div>
          </td>
          <td>
                <code>1.0</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>torch.Tensor: Predicted mel spectrogram.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>models/tts/delightful_tts/acoustic_model/acoustic_model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">speakers</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">langs</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">d_control</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Forward pass during model inference.</span>

<span class="sd">    The forward pass receives phoneme sequence, speaker identities, languages, pitch control and</span>
<span class="sd">    duration control, conducts a series of operations on these inputs and returns the predicted mel</span>
<span class="sd">    spectrogram.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (torch.Tensor): Tensor of phoneme sequences.</span>
<span class="sd">        speakers (torch.Tensor): Tensor of speaker identities.</span>
<span class="sd">        langs (torch.Tensor): Tensor of language identities.</span>
<span class="sd">        d_control (float): Duration control parameter. Defaults to 1.0.</span>

<span class="sd">    Returns:</span>
<span class="sd">        torch.Tensor: Predicted mel spectrogram.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate masks for padding positions in the source sequences</span>
    <span class="n">src_mask</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_mask_from_lengths</span><span class="p">(</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

    <span class="c1"># Obtain the embeddings for the input</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_embeddings</span><span class="p">(</span>
        <span class="n">token_idx</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">speaker_idx</span><span class="o">=</span><span class="n">speakers</span><span class="p">,</span>
        <span class="n">src_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
        <span class="n">lang_idx</span><span class="o">=</span><span class="n">langs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Generate positional encodings</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="n">positional_encoding</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emb_dim</span><span class="p">,</span>
        <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

    <span class="c1"># Process the embeddings through the encoder</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

    <span class="c1"># Predict prosody at utterance level and phoneme level</span>
    <span class="n">u_prosody_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_norm</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">average_utterance_prosody</span><span class="p">(</span>
            <span class="n">u_prosody_pred</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">utterance_prosody_predictor</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">),</span>
            <span class="n">src_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">p_prosody_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_norm</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phoneme_prosody_predictor</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_bottle_out</span><span class="p">(</span><span class="n">u_prosody_pred</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_bottle_out</span><span class="p">(</span><span class="n">p_prosody_pred</span><span class="p">)</span>

    <span class="n">x_res</span> <span class="o">=</span> <span class="n">x</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_adaptor_conv</span><span class="o">.</span><span class="n">add_pitch_embedding</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_adaptor</span><span class="o">.</span><span class="n">add_energy_embedding</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_regulator</span><span class="o">.</span><span class="n">upsample</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">x_res</span><span class="o">=</span><span class="n">x_res</span><span class="p">,</span>
        <span class="n">src_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
        <span class="n">control</span><span class="o">=</span><span class="n">d_control</span><span class="p">,</span>
        <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">mel_mask</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_mask_from_lengths</span><span class="p">(</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">encoding</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="n">positional_encoding</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emb_dim</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

    <span class="n">decoder_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">mel_mask</span><span class="p">,</span>
        <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
        <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_mel</span><span class="p">(</span><span class="n">decoder_output</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">permute</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.forward_train" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">forward_train</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">speakers</span><span class="p">,</span> <span class="n">src_lens</span><span class="p">,</span> <span class="n">mels</span><span class="p">,</span> <span class="n">mel_lens</span><span class="p">,</span> <span class="n">pitches</span><span class="p">,</span> <span class="n">langs</span><span class="p">,</span> <span class="n">attn_priors</span><span class="p">,</span> <span class="n">energies</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Forward pass during training phase.</p>
<p>For a given phoneme sequence, speaker identities, sequence lengths, mels,
mel lengths, pitches, language, and attention priors, the forward pass
processes these inputs through the defined architecture.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor of phoneme sequence.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>speakers</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor of speaker identities.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>src_lens</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Long tensor representing the lengths of source sequences.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mels</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor of mel spectrograms.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mel_lens</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Long tensor representing the lengths of mel sequences.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>pitches</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor of pitch values.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>langs</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor of language identities.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>attn_priors</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Prior attention values.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>energies</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor of energy values.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, <span title="torch.Tensor">Tensor</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dict[str, torch.Tensor]: Returns the prediction outputs as a dictionary.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>models/tts/delightful_tts/acoustic_model/acoustic_model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">forward_train</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">speakers</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">src_lens</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">mels</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">mel_lens</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">pitches</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">langs</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">attn_priors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">energies</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Forward pass during training phase.</span>

<span class="sd">    For a given phoneme sequence, speaker identities, sequence lengths, mels,</span>
<span class="sd">    mel lengths, pitches, language, and attention priors, the forward pass</span>
<span class="sd">    processes these inputs through the defined architecture.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (torch.Tensor): Tensor of phoneme sequence.</span>
<span class="sd">        speakers (torch.Tensor): Tensor of speaker identities.</span>
<span class="sd">        src_lens (torch.Tensor): Long tensor representing the lengths of source sequences.</span>
<span class="sd">        mels (torch.Tensor): Tensor of mel spectrograms.</span>
<span class="sd">        mel_lens (torch.Tensor): Long tensor representing the lengths of mel sequences.</span>
<span class="sd">        pitches (torch.Tensor): Tensor of pitch values.</span>
<span class="sd">        langs (torch.Tensor): Tensor of language identities.</span>
<span class="sd">        attn_priors (torch.Tensor): Prior attention values.</span>
<span class="sd">        energies (torch.Tensor): Tensor of energy values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict[str, torch.Tensor]: Returns the prediction outputs as a dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate masks for padding positions in the source sequences and mel sequences</span>
    <span class="n">src_mask</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_mask_from_lengths</span><span class="p">(</span><span class="n">src_lens</span><span class="p">)</span>
    <span class="n">mel_mask</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_mask_from_lengths</span><span class="p">(</span><span class="n">mel_lens</span><span class="p">)</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_embeddings</span><span class="p">(</span>
        <span class="n">token_idx</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">speaker_idx</span><span class="o">=</span><span class="n">speakers</span><span class="p">,</span>
        <span class="n">src_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
        <span class="n">lang_idx</span><span class="o">=</span><span class="n">langs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">encoding</span> <span class="o">=</span> <span class="n">positional_encoding</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emb_dim</span><span class="p">,</span>
        <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">mel_lens</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">())),</span>
    <span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">src_mask</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">src_mask</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">src_mask</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

    <span class="n">u_prosody_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_norm</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utterance_prosody_encoder</span><span class="p">(</span><span class="n">mels</span><span class="o">=</span><span class="n">mels</span><span class="p">,</span> <span class="n">mel_lens</span><span class="o">=</span><span class="n">mel_lens</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">u_prosody_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_norm</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">average_utterance_prosody</span><span class="p">(</span>
            <span class="n">u_prosody_pred</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">utterance_prosody_predictor</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">),</span>
            <span class="n">src_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">p_prosody_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_norm</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phoneme_prosody_encoder</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">src_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
            <span class="n">mels</span><span class="o">=</span><span class="n">mels</span><span class="p">,</span>
            <span class="n">mel_lens</span><span class="o">=</span><span class="n">mel_lens</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">p_prosody_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_norm</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phoneme_prosody_predictor</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_bottle_out</span><span class="p">(</span><span class="n">u_prosody_pred</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_bottle_out</span><span class="p">(</span><span class="n">p_prosody_pred</span><span class="p">)</span>

    <span class="c1"># Save the residual for later use</span>
    <span class="n">x_res</span> <span class="o">=</span> <span class="n">x</span>

    <span class="n">attn_logprob</span><span class="p">,</span> <span class="n">attn_soft</span><span class="p">,</span> <span class="n">attn_hard</span><span class="p">,</span> <span class="n">attn_hard_dur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aligner</span><span class="p">(</span>
        <span class="n">enc_in</span><span class="o">=</span><span class="n">x_res</span><span class="o">.</span><span class="n">permute</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="n">dec_in</span><span class="o">=</span><span class="n">mels</span><span class="p">,</span>
        <span class="n">enc_len</span><span class="o">=</span><span class="n">src_lens</span><span class="p">,</span>
        <span class="n">dec_len</span><span class="o">=</span><span class="n">mel_lens</span><span class="p">,</span>
        <span class="n">enc_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
        <span class="n">attn_prior</span><span class="o">=</span><span class="n">attn_priors</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">attn_hard_dur</span> <span class="o">=</span> <span class="n">attn_hard_dur</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">src_mask</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">pitch_prediction</span><span class="p">,</span> <span class="n">avg_pitch_target</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pitch_adaptor_conv</span><span class="o">.</span><span class="n">add_pitch_embedding_train</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">pitches</span><span class="p">,</span>
            <span class="n">dr</span><span class="o">=</span><span class="n">attn_hard_dur</span><span class="p">,</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">energies</span> <span class="o">=</span> <span class="n">energies</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">src_mask</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">energy_pred</span><span class="p">,</span> <span class="n">avg_energy_target</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energy_adaptor</span><span class="o">.</span><span class="n">add_energy_embedding_train</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">energies</span><span class="p">,</span>
            <span class="n">dr</span><span class="o">=</span><span class="n">attn_hard_dur</span><span class="p">,</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">log_duration_prediction</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_regulator</span><span class="o">.</span><span class="n">upsample_train</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">x_res</span><span class="o">=</span><span class="n">x_res</span><span class="p">,</span>
        <span class="n">duration_target</span><span class="o">=</span><span class="n">attn_hard_dur</span><span class="p">,</span>
        <span class="n">src_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">,</span>
        <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Decode the encoder output to pred mel spectrogram</span>
    <span class="n">decoder_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">mel_mask</span><span class="p">,</span>
        <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
        <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">y_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_mel</span><span class="p">(</span><span class="n">decoder_output</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">permute</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;y_pred&quot;</span><span class="p">:</span> <span class="n">y_pred</span><span class="p">,</span>
        <span class="s2">&quot;pitch_prediction&quot;</span><span class="p">:</span> <span class="n">pitch_prediction</span><span class="p">,</span>
        <span class="s2">&quot;pitch_target&quot;</span><span class="p">:</span> <span class="n">avg_pitch_target</span><span class="p">,</span>
        <span class="s2">&quot;energy_pred&quot;</span><span class="p">:</span> <span class="n">energy_pred</span><span class="p">,</span>
        <span class="s2">&quot;energy_target&quot;</span><span class="p">:</span> <span class="n">avg_energy_target</span><span class="p">,</span>
        <span class="s2">&quot;log_duration_prediction&quot;</span><span class="p">:</span> <span class="n">log_duration_prediction</span><span class="p">,</span>
        <span class="s2">&quot;u_prosody_pred&quot;</span><span class="p">:</span> <span class="n">u_prosody_pred</span><span class="p">,</span>
        <span class="s2">&quot;u_prosody_ref&quot;</span><span class="p">:</span> <span class="n">u_prosody_ref</span><span class="p">,</span>
        <span class="s2">&quot;p_prosody_pred&quot;</span><span class="p">:</span> <span class="n">p_prosody_pred</span><span class="p">,</span>
        <span class="s2">&quot;p_prosody_ref&quot;</span><span class="p">:</span> <span class="n">p_prosody_ref</span><span class="p">,</span>
        <span class="s2">&quot;attn_logprob&quot;</span><span class="p">:</span> <span class="n">attn_logprob</span><span class="p">,</span>
        <span class="s2">&quot;attn_soft&quot;</span><span class="p">:</span> <span class="n">attn_soft</span><span class="p">,</span>
        <span class="s2">&quot;attn_hard&quot;</span><span class="p">:</span> <span class="n">attn_hard</span><span class="p">,</span>
        <span class="s2">&quot;attn_hard_dur&quot;</span><span class="p">:</span> <span class="n">attn_hard_dur</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.freeze_params" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">freeze_params</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Freeze the trainable parameters in the model.</p>
<p>By freezing, the parameters are no longer updated by gradient descent.
This is typically done when you want to keep parts of your model fixed while training other parts.
For this model, it freezes all parameters and then selectively unfreezes the
speaker embeddings and the pitch adaptor's pitch embeddings to allow these components to update during training.</p>
<p>Returns
    None</p>

          <details class="quote">
            <summary>Source code in <code>models/tts/delightful_tts/acoustic_model/acoustic_model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">freeze_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Freeze the trainable parameters in the model.</span>

<span class="sd">    By freezing, the parameters are no longer updated by gradient descent.</span>
<span class="sd">    This is typically done when you want to keep parts of your model fixed while training other parts.</span>
<span class="sd">    For this model, it freezes all parameters and then selectively unfreezes the</span>
<span class="sd">    speaker embeddings and the pitch adaptor&#39;s pitch embeddings to allow these components to update during training.</span>

<span class="sd">    Returns</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
        <span class="n">par</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">speaker_embed</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.get_embeddings" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_embeddings</span><span class="p">(</span><span class="n">token_idx</span><span class="p">,</span> <span class="n">speaker_idx</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">,</span> <span class="n">lang_idx</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Given the tokens, speakers, source mask, and language indices, compute
the embeddings for tokens, speakers and languages and return the
token_embeddings and combined speaker and language embeddings</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>token_idx</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor of token indices.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>speaker_idx</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor of speaker identities.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>src_mask</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Mask tensor for source sequences.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>lang_idx</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor of language indices.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tuple[torch.Tensor, torch.Tensor]: Token embeddings tensor,</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>and combined speaker and language embeddings tensor.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>models/tts/delightful_tts/acoustic_model/acoustic_model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_embeddings</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">token_idx</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">speaker_idx</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">src_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">lang_idx</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Given the tokens, speakers, source mask, and language indices, compute</span>
<span class="sd">    the embeddings for tokens, speakers and languages and return the</span>
<span class="sd">    token_embeddings and combined speaker and language embeddings</span>

<span class="sd">    Args:</span>
<span class="sd">        token_idx (torch.Tensor): Tensor of token indices.</span>
<span class="sd">        speaker_idx (torch.Tensor): Tensor of speaker identities.</span>
<span class="sd">        src_mask (torch.Tensor): Mask tensor for source sequences.</span>
<span class="sd">        lang_idx (torch.Tensor): Tensor of language indices.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[torch.Tensor, torch.Tensor]: Token embeddings tensor,</span>
<span class="sd">        and combined speaker and language embeddings tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">token_embeddings</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">token_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_word_emb</span><span class="p">)</span>
    <span class="c1"># NOTE: here you can manage the speaker embeddings, can be used for the voice export ?</span>
    <span class="n">speaker_embeds</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">speaker_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">speaker_embed</span><span class="p">)</span>
    <span class="n">lang_embeds</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">lang_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang_embed</span><span class="p">)</span>

    <span class="c1"># Merge the speaker and language embeddings</span>
    <span class="n">embeddings</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">speaker_embeds</span><span class="p">,</span> <span class="n">lang_embeds</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Apply the mask to the embeddings and token embeddings</span>
    <span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">masked_fill</span><span class="p">(</span><span class="n">src_mask</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">token_embeddings</span> <span class="o">=</span> <span class="n">token_embeddings</span><span class="o">.</span><span class="n">masked_fill</span><span class="p">(</span><span class="n">src_mask</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">token_embeddings</span><span class="p">,</span> <span class="n">embeddings</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.prepare_for_export" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">prepare_for_export</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Prepare the model for export.</p>
<p>This method is called when the model is about to be exported, such as for deployment
or serializing for later use. The method removes unnecessary components that are
not needed during inference. Specifically, it removes the phoneme and utterance
prosody encoders for this acoustic model. These components are typically used during
training and are not needed when the model is used for making predictions.</p>
<p>Returns
    None</p>

          <details class="quote">
            <summary>Source code in <code>models/tts/delightful_tts/acoustic_model/acoustic_model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">prepare_for_export</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Prepare the model for export.</span>

<span class="sd">    This method is called when the model is about to be exported, such as for deployment</span>
<span class="sd">    or serializing for later use. The method removes unnecessary components that are</span>
<span class="sd">    not needed during inference. Specifically, it removes the phoneme and utterance</span>
<span class="sd">    prosody encoders for this acoustic model. These components are typically used during</span>
<span class="sd">    training and are not needed when the model is used for making predictions.</span>

<span class="sd">    Returns</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">phoneme_prosody_encoder</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">utterance_prosody_encoder</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="models.tts.delightful_tts.acoustic_model.acoustic_model.AcousticModel.unfreeze_params" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">unfreeze_params</span><span class="p">(</span><span class="n">freeze_text_embed</span><span class="p">,</span> <span class="n">freeze_lang_embed</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Unfreeze the trainable parameters in the model, allowing them to be updated during training.</p>
<p>This method is typically used to 'unfreeze' previously 'frozen' parameters, making them trainable again.
For this model, it unfreezes all parameters and then selectively freezes the
text embeddings and language embeddings, if required.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>freeze_text_embed</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Flag to indicate if text embeddings should remain frozen.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>freeze_lang_embed</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Flag to indicate if language embeddings should remain frozen.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>None</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>models/tts/delightful_tts/acoustic_model/acoustic_model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">unfreeze_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freeze_text_embed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">freeze_lang_embed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Unfreeze the trainable parameters in the model, allowing them to be updated during training.</span>

<span class="sd">    This method is typically used to &#39;unfreeze&#39; previously &#39;frozen&#39; parameters, making them trainable again.</span>
<span class="sd">    For this model, it unfreezes all parameters and then selectively freezes the</span>
<span class="sd">    text embeddings and language embeddings, if required.</span>

<span class="sd">    Args:</span>
<span class="sd">        freeze_text_embed (bool): Flag to indicate if text embeddings should remain frozen.</span>
<span class="sd">        freeze_lang_embed (bool): Flag to indicate if language embeddings should remain frozen.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Iterate through all model parameters and make them trainable</span>
    <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
        <span class="n">par</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># If freeze_text_embed flag is True, keep the source word embeddings frozen</span>
    <span class="k">if</span> <span class="n">freeze_text_embed</span><span class="p">:</span>
        <span class="c1"># @fixed self.src_word_emb.parameters has no parameters() method!</span>
        <span class="c1"># for par in self.src_word_emb.parameters():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src_word_emb</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># If freeze_lang_embed flag is True, keep the language embeddings frozen</span>
    <span class="k">if</span> <span class="n">freeze_lang_embed</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lang_embed</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../readme/" class="md-footer__link md-footer__link--prev" aria-label="Previous: References">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                References
              </div>
            </div>
          </a>
        
        
          
          <a href="../embedding/" class="md-footer__link md-footer__link--next" aria-label="Next: Embedding">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Embedding
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.footer"], "search": "../../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.aecac24b.min.js"></script>
      
        <script src="../../../../../javascripts/katex.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>